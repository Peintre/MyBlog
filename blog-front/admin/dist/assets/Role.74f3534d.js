import{p as U}from"./common.10683f1a.js";import{ag as r,aj as O,o as w,Q as L,R as t,a as u,W as p,X as l,V as i,a7 as A,S as J}from"./@vue.9e9a2d45.js";import{_ as K}from"./index.ae6b5db7.js";import"./dayjs.68f6f475.js";import"./@babel.1ce85722.js";import"./axios.cdba3bd7.js";import"./form-data.d1f94bc2.js";import"./vue-router.b11bef48.js";import"./vuex.029ab250.js";import"./vuex-persistedstate.fa252374.js";import"./nprogress.8c2c2e00.js";import"./vue-axios.516efde1.js";import"./element-plus.e856da41.js";import"./lodash-es.1d9717e1.js";import"./@vueuse.15af719d.js";import"./@element-plus.b2728cca.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.f14f28ca.js";import"./@kangc.b9a0ef8b.js";import"./vue.a84c3055.js";import"./markdown-it-emoji.952032df.js";import"./@vuepress.3e7afe62.js";import"./markdown-it-container.512a5043.js";import"./highlight.js.6e93349b.js";import"./codemirror.59d98cc1.js";const Y={created(){this.listRoles()},data:function(){return{loading:!0,isDelete:!1,isAdd:!1,roleList:[],roleIdList:[],keywords:null,current:1,size:10,count:0,roleMenu:!1,roleResource:!1,resourceList:[],menuList:[],roleForm:{roleName:"",roleLabel:"",isDisable:0,resourceIdList:[],menuIdList:[]}}},computed:{dataFormat(){return function(e){return U(e,"YYYY-MM-DD")}}},methods:{searchRoles(){this.current=1,this.listRoles()},resetRoles(){this.keywords=null,this.current=1,this.listRoles()},sizeChange(e){this.size=e,this.listRoles()},currentChange(e){this.current=e,this.listRoles()},selectionChange(e){this.roleIdList=[],e.forEach(o=>{this.roleIdList.push(o.id)})},listRoles(){this.axios.get("/api/role/getAllRoles",{params:{current:this.current,size:this.size,keywords:this.keywords}}).then(({data:e})=>{this.roleList=e.data.recordList,this.count=e.data.count,this.loading=!1}),this.axios.get("/api/resource/getAllResources").then(({data:e})=>{this.resourceList=e.data}),this.axios.get("/api/menu/getAllMenus").then(({data:e})=>{this.menuList=e.data})},deleteRoles(e){var o={};e==null?o={data:this.roleIdList}:o={data:[e]},this.axios.delete("/api/role/deleteRoles",o).then(({data:h})=>{h.flag?(this.$notify.success({title:"\u6210\u529F",message:h.message}),this.listRoles()):this.$notify.error({title:"\u5931\u8D25",message:h.message}),this.isDelete=!1})},openMenuModel(e){this.roleForm=JSON.parse(JSON.stringify(e)),this.roleMenu=!0,this.$nextTick(()=>{this.$refs.menuTree.setCheckedKeys(e.menuIdList)})},openResourceModel(e){debugger;this.roleForm=JSON.parse(JSON.stringify(e)),console.log(this.roleForm),this.roleResource=!0,this.$nextTick(()=>{this.$refs.resourceTree.setCheckedKeys(e.resourceIdList)})},openRoleModel(e){e?this.roleForm=JSON.parse(JSON.stringify(e)):(this.roleForm.roleName="",this.roleForm.roleLabel="",this.roleForm.menuIdList=null,this.roleForm.resourceIdList=null),this.isAdd=!0},saveNewRole(){if(!this.roleForm.roleName||this.roleForm.roleName.trim()=="")return this.$message.error("\u89D2\u8272\u540D\u4E0D\u80FD\u4E3A\u7A7A"),!1;if(!this.roleForm.roleLabel||this.roleForm.roleLabel.trim()=="")return this.$message.error("\u6743\u9650\u6807\u7B7E\u4E0D\u80FD\u4E3A\u7A7A"),!1;this.roleForm.id?this.axios.post("/api/role/updateRole",this.roleForm).then(({data:e})=>{e.flag?(this.$notify.success({title:"\u6210\u529F",message:e.message}),this.listRoles()):this.$notify.error({title:"\u5931\u8D25",message:e.message}),this.isAdd=!1}):this.axios.post("/api/role/addRole",this.roleForm).then(({data:e})=>{e.flag?(this.$notify.success({title:"\u6210\u529F",message:e.message}),this.listRoles()):this.$notify.error({title:"\u5931\u8D25",message:e.message}),this.isAdd=!1})},changeDisable(e){this.roleForm=JSON.parse(JSON.stringify(e)),this.axios.post("/api/role/updateRole",this.roleForm).then(({data:o})=>{o.flag?(this.$notify.success({title:"\u6210\u529F",message:o.message}),this.listRoles()):this.$notify.error({title:"\u5931\u8D25",message:o.message})})},saveOrUpdateRoleResource(){this.roleForm.menuIdList=null,this.roleForm.resourceIdList=this.$refs.resourceTree.getCheckedKeys(),this.axios.post("/api/role/updateRoleMenuResource",this.roleForm).then(({data:e})=>{e.flag?(this.$notify.success({title:"\u6210\u529F",message:e.message}),this.listRoles()):this.$notify.error({title:"\u5931\u8D25",message:e.message}),this.roleResource=!1})},saveOrUpdateRoleMenu(){this.roleForm.resourceIdList=null,this.roleForm.menuIdList=this.$refs.menuTree.getCheckedKeys().concat(this.$refs.menuTree.getHalfCheckedKeys()),this.axios.post("/api/role/updateRoleMenuResource",this.roleForm).then(({data:e})=>{e.flag?(this.$notify.success({title:"\u6210\u529F",message:e.message}),this.listRoles()):this.$notify.error({title:"\u5931\u8D25",message:e.message}),this.roleMenu=!1})}}},B={class:"title"},E={class:"operation-container"},W={style:{"margin-left":"auto"}},j={class:"dialog-footer"},P={class:"dialog-footer"},H=u("div",{style:{"font-size":"1rem"}},"\u662F\u5426\u5220\u9664\u9009\u4E2D\u9879\uFF1F",-1),Q={class:"dialog-footer"};function X(e,o,h,q,G,a){const V=r("Plus"),d=r("el-icon"),n=r("el-button"),C=r("Delete"),R=r("Search"),y=r("el-input"),f=r("el-table-column"),_=r("el-tag"),b=r("el-switch"),z=r("Timer"),F=r("Edit"),D=r("FolderChecked"),M=r("el-popconfirm"),N=r("el-table"),$=r("el-pagination"),m=r("el-form-item"),v=r("el-tree"),k=r("el-form"),g=r("el-dialog"),I=r("Warning"),S=r("el-card"),T=O("loading");return w(),L(S,{class:"main-card"},{default:t(()=>[u("div",B,p(this.$route.name),1),u("div",E,[l(n,{type:"primary",size:"small",onClick:a.openRoleModel},{default:t(()=>[l(d,null,{default:t(()=>[l(V)]),_:1}),i("\u65B0\u589E ")]),_:1},8,["onClick"]),l(n,{type:"danger",size:"small",disabled:this.roleIdList.length==0,onClick:o[0]||(o[0]=s=>e.isDelete=!0)},{default:t(()=>[l(d,null,{default:t(()=>[l(C)]),_:1}),i("\u6279\u91CF\u5220\u9664 ")]),_:1},8,["disabled"]),u("div",W,[l(y,{modelValue:e.keywords,"onUpdate:modelValue":o[1]||(o[1]=s=>e.keywords=s),size:"small",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",style:{width:"200px"},onKeyup:A(a.searchRoles,["enter","native"])},{prefix:t(()=>[l(d,null,{default:t(()=>[l(R)]),_:1})]),_:1},8,["modelValue","onKeyup"]),l(n,{type:"primary",size:"small",style:{"margin-left":"1rem"},onClick:a.searchRoles},{default:t(()=>[l(d,null,{default:t(()=>[l(R)]),_:1}),i(" \u641C\u7D22 ")]),_:1},8,["onClick"]),l(n,{type:"primary",size:"small",style:{"margin-left":"1rem"},onClick:a.resetRoles},{default:t(()=>[i(" \u91CD\u7F6E ")]),_:1},8,["onClick"])])]),J((w(),L(N,{data:e.roleList,border:"",onSelectionChange:a.selectionChange},{default:t(()=>[l(f,{type:"selection",width:"55"}),l(f,{prop:"roleName",label:"\u89D2\u8272\u540D",align:"center"}),l(f,{prop:"roleLabel",label:"\u6743\u9650\u6807\u7B7E",align:"center"},{default:t(s=>[l(_,null,{default:t(()=>[i(p(s.row.roleLabel),1)]),_:2},1024)]),_:1}),l(f,{prop:"isDisable",label:"\u7981\u7528",align:"center",width:"100"},{default:t(s=>[l(b,{modelValue:s.row.isDisable,"onUpdate:modelValue":c=>s.row.isDisable=c,"active-color":"#13ce66","inactive-color":"#F4F4F5","active-value":1,"inactive-value":0,onChange:c=>a.changeDisable(s.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(f,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4",width:"150",align:"center"},{default:t(s=>[l(d,{style:{"margin-right":"5px"}},{default:t(()=>[l(z)]),_:1}),i(" "+p(a.dataFormat(s.row.createTime)),1)]),_:1}),l(f,{label:"\u64CD\u4F5C",align:"center",width:"280"},{default:t(s=>[l(n,{link:"",type:"primary",size:"small",onClick:c=>a.openMenuModel(s.row)},{default:t(()=>[l(d,null,{default:t(()=>[l(F)]),_:1}),i(" \u83DC\u5355\u6743\u9650 ")]),_:2},1032,["onClick"]),l(n,{link:"",type:"primary",size:"small",onClick:c=>a.openResourceModel(s.row)},{default:t(()=>[l(d,null,{default:t(()=>[l(D)]),_:1}),i(" \u8D44\u6E90\u6743\u9650 ")]),_:2},1032,["onClick"]),l(n,{link:"",type:"primary",size:"small",onClick:c=>a.openRoleModel(s.row)},{default:t(()=>[l(d,null,{default:t(()=>[l(F)]),_:1}),i(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),l(M,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",style:{"margin-left":"10px"},"confirm-button-text":"\u786E\u5B9A","cancel-button-text":"\u53D6\u6D88",onConfirm:c=>a.deleteRoles(s.row.id)},{reference:t(()=>[l(n,{size:"small",link:"",type:"primary",slot:"reference"},{default:t(()=>[l(d,null,{default:t(()=>[l(C)]),_:1}),i(" \u5220\u9664 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[T,e.loading]]),l($,{class:"pagination-container",background:"",onSizeChange:a.sizeChange,onCurrentChange:a.currentChange,"current-page":e.current,"page-size":e.size,total:e.count,"page-sizes":[5,10],layout:"total, sizes, prev, pager, next, jumper"},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"]),l(g,{modelValue:e.roleMenu,"onUpdate:modelValue":o[3]||(o[3]=s=>e.roleMenu=s),width:"30%",title:"\u89D2\u8272\u83DC\u5355\u6743\u9650\u4FEE\u6539",center:""},{footer:t(()=>[u("span",j,[l(n,{onClick:o[2]||(o[2]=s=>e.roleMenu=!1)},{default:t(()=>[i("\u53D6 \u6D88")]),_:1}),l(n,{type:"primary",onClick:a.saveOrUpdateRoleMenu},{default:t(()=>[i("\u786E \u5B9A")]),_:1},8,["onClick"])])]),default:t(()=>[l(k,{"label-width":"80px",size:"default",model:e.roleForm},{default:t(()=>[l(m,{label:"\u89D2\u8272\u540D:"},{default:t(()=>[u("span",null,p(e.roleForm.roleName),1)]),_:1}),l(m,{label:"\u6743\u9650\u6807\u7B7E:"},{default:t(()=>[l(_,null,{default:t(()=>[i(p(e.roleForm.roleLabel),1)]),_:1})]),_:1}),l(m,{label:"\u83DC\u5355\u6743\u9650:"},{default:t(()=>[l(v,{data:e.menuList,"default-checked-keys":e.roleForm.menuIdList,"check-strictly":"","show-checkbox":"","node-key":"id",ref:"menuTree"},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(g,{modelValue:e.roleResource,"onUpdate:modelValue":o[5]||(o[5]=s=>e.roleResource=s),width:"30%",top:"9vh",title:"\u89D2\u8272\u8D44\u6E90\u6743\u9650\u4FEE\u6539",center:""},{footer:t(()=>[u("span",P,[l(n,{onClick:o[4]||(o[4]=s=>e.roleResource=!1)},{default:t(()=>[i("\u53D6 \u6D88")]),_:1}),l(n,{type:"primary",onClick:a.saveOrUpdateRoleResource},{default:t(()=>[i(" \u786E \u5B9A ")]),_:1},8,["onClick"])])]),default:t(()=>[l(k,{"label-width":"80px",size:"default",model:e.roleForm},{default:t(()=>[l(m,{label:"\u89D2\u8272\u540D:"},{default:t(()=>[u("span",null,p(e.roleForm.roleName),1)]),_:1}),l(m,{label:"\u6743\u9650\u6807\u7B7E:"},{default:t(()=>[l(_,null,{default:t(()=>[i(p(e.roleForm.roleLabel),1)]),_:1})]),_:1}),l(m,{label:"\u8D44\u6E90\u6743\u9650:"},{default:t(()=>[l(v,{data:e.resourceList,"default-checked-keys":e.roleForm.resourceIdList,"show-checkbox":"","node-key":"id",ref:"resourceTree"},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(g,{modelValue:e.isDelete,"onUpdate:modelValue":o[8]||(o[8]=s=>e.isDelete=s),width:"30%"},{header:t(()=>[l(d,{style:{color:"#ff9900"}},{default:t(()=>[l(I)]),_:1}),i("\u63D0\u793A ")]),footer:t(()=>[l(n,{onClick:o[6]||(o[6]=s=>e.isDelete=!1)},{default:t(()=>[i("\u53D6 \u6D88")]),_:1}),l(n,{type:"primary",onClick:o[7]||(o[7]=s=>a.deleteRoles(null))},{default:t(()=>[i(" \u786E \u5B9A ")]),_:1})]),default:t(()=>[H]),_:1},8,["modelValue"]),l(g,{modelValue:e.isAdd,"onUpdate:modelValue":o[13]||(o[13]=s=>e.isAdd=s),width:"30%",title:"\u65B0\u589E\u89D2\u8272",center:""},{footer:t(()=>[u("span",Q,[l(n,{onClick:o[12]||(o[12]=s=>e.isAdd=!1)},{default:t(()=>[i("\u53D6 \u6D88")]),_:1}),l(n,{type:"primary",onClick:a.saveNewRole},{default:t(()=>[i("\u786E \u5B9A")]),_:1},8,["onClick"])])]),default:t(()=>[l(k,{"label-width":"80px",size:"default",model:e.roleForm},{default:t(()=>[l(m,{label:"\u89D2\u8272\u540D\u79F0:"},{default:t(()=>[l(y,{modelValue:e.roleForm.roleName,"onUpdate:modelValue":o[9]||(o[9]=s=>e.roleForm.roleName=s),style:{width:"250px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"\u6743\u9650\u6807\u7B7E:"},{default:t(()=>[l(y,{modelValue:e.roleForm.roleLabel,"onUpdate:modelValue":o[10]||(o[10]=s=>e.roleForm.roleLabel=s),style:{width:"250px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"\u662F\u5426\u7981\u7528:"},{default:t(()=>[l(b,{modelValue:e.roleForm.isDisable,"onUpdate:modelValue":o[11]||(o[11]=s=>e.roleForm.isDisable=s),"active-color":"#13ce66","inactive-color":"#F4F4F5","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}var ze=K(Y,[["render",X]]);export{ze as default};
