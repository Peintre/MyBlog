import{i as O}from"./image-conversion.2d06665b.js";import{p as Y}from"./common.10683f1a.js";import{ag as n,o as c,Q as p,R as i,a as m,W as f,X as s,V as d,U as _,S as j,Y as M,a7 as I,c as y,a6 as b,F as T,L as A,b7 as q,b6 as Q}from"./@vue.9e9a2d45.js";import{_ as R}from"./index.ae6b5db7.js";import"./@babel.1ce85722.js";import"./dayjs.68f6f475.js";import"./axios.cdba3bd7.js";import"./form-data.d1f94bc2.js";import"./vue-router.b11bef48.js";import"./vuex.029ab250.js";import"./vuex-persistedstate.fa252374.js";import"./nprogress.8c2c2e00.js";import"./vue-axios.516efde1.js";import"./element-plus.e856da41.js";import"./lodash-es.1d9717e1.js";import"./@vueuse.15af719d.js";import"./@element-plus.b2728cca.js";import"./@popperjs.36402333.js";import"./@ctrl.82a509e0.js";import"./async-validator.fb49d0f5.js";import"./memoize-one.4ee5c96d.js";import"./escape-html.e5dfadb9.js";import"./normalize-wheel-es.8aeb3683.js";import"./@floating-ui.f14f28ca.js";import"./@kangc.b9a0ef8b.js";import"./vue.a84c3055.js";import"./markdown-it-emoji.952032df.js";import"./@vuepress.3e7afe62.js";import"./markdown-it-container.512a5043.js";import"./highlight.js.6e93349b.js";import"./codemirror.59d98cc1.js";const W={created(){this.articleType()},unmounted(){this.autoSaveArticle()},data:function(){return{addOrEdit:!1,autoSave:!0,categoryName:"",tagName:"",leftToolbar:"undo clear | h bold italic strikethrough quote | ul ol table hr | link image code | save | tips emoji",toolbar:{tips:{icon:"v-md-icon-tip",title:"\u63D0\u793A\u4FE1\u606F",menus:[{name:"info",text:"info",action(e){e.insert(function(t){const r="::: details",o=":::",l=t||"\u8BF7\u8F93\u5165\u6587\u672C";return{text:`${r}
${l}
${o}`,selected:l}})}},{name:"success",text:"success",action(e){e.insert(function(t){const r="::: tip",o=":::",l=t||"\u8BF7\u8F93\u5165\u6587\u672C";return{text:`${r}
${l}
${o}`,selected:l}})}},{name:"warning",text:"warning",action(e){e.insert(function(t){const r="::: warning",o=":::",l=t||"\u8BF7\u8F93\u5165\u6587\u672C";return{text:`${r}
${l}
${o}`,selected:l}})}},{name:"danger",text:"danger",action(e){e.insert(function(t){const r="::: danger",o=":::",l=t||"\u8BF7\u8F93\u5165\u6587\u672C";return{text:`${r}
${l}
${o}`,selected:l}})}}]}},categoryList:[],tagList:[],typeList:[{type:1,desc:"\u539F\u521B"},{type:2,desc:"\u8F6C\u8F7D"},{type:3,desc:"\u7FFB\u8BD1"}],article:{id:null,articleTitle:"",articleContent:"",articleCover:"",categoryName:null,tagNameList:[],originalUrl:"",isTop:0,type:1,status:1}}},methods:{test(){alert("aaa")},articleType(){let e=this.$route.params.id;const t=this;if(e)this.axios.get("/api/article/getBackArticle/"+e).then(({data:r})=>{t.article=r.data});else{const r=sessionStorage.getItem("article");r&&(t.article=JSON.parse(r))}},listCategories(){this.axios.get("/api/category/getCategory").then(({data:e})=>{this.categoryList=e.data})},listTags(){this.axios.get("/api/tag/getTag").then(({data:e})=>{this.tagList=e.data})},openModel(){if(this.article.articleTitle.trim()=="")return this.$message.error("\u6587\u7AE0\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),!1;if(this.article.articleContent.trim()=="")return this.$message.error("\u6587\u7AE0\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),!1;this.listCategories(),this.listTags(),this.addOrEdit=!0},uploadCover(e){this.$message.success("\u4E0A\u4F20\u6210\u529F"),this.article.articleCover=e.data},beforeUpload(e){return["image/jpeg","image/png","image/gif"].includes(e.type)?new Promise((o,v)=>{e.size/1024<200&&o(e),O.compressAccurately(e,200).then(l=>{o(l)})}):(this.$message.error("\u56FE\u7247\u683C\u5F0F\u53EA\u80FD\u662F JPG/PNG/GIF!"),!1)},handleUploadImage(e,t,r){let o=r[0];if(!["image/jpeg","image/png","image/gif"].includes(o.type))return this.$message.error("\u56FE\u7247\u683C\u5F0F\u53EA\u80FD\u662F JPG/PNG/GIF!"),!1;let g=new FormData;o.size/1024<200?(g.append("file",o),this.axios.post("/api/article/images",g).then(({data:u})=>{t({url:u.data,desc:"description",width:"auto",height:"auto"})})):O.compressAccurately(o,200).then(u=>{g.append("file",new window.File([u],o.name,{type:o.type})),this.axios.post("/api/article/images",g).then(({data:V})=>{t({url:V.data,desc:"description",width:"auto",height:"auto"})})})},saveChicked(){this.autoSave&&this.article.id==null&&sessionStorage.setItem("article",JSON.stringify(this.article))},saveArticleDraft(){if(this.article.articleTitle.trim()=="")return this.$message.error("\u6587\u7AE0\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),!1;if(this.article.articleContent.trim()=="")return this.$message.error("\u6587\u7AE0\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),!1;this.article.status=3,this.axios.post("/api/article/saveOrUpdateArticle",this.article).then(({data:e})=>{e.flag?(this.article.id===null?this.$store.commit("removeTab","\u53D1\u5E03\u6587\u7AE0"):this.$store.commit("removeTab","\u4FEE\u6539\u6587\u7AE0"),sessionStorage.removeItem("article"),this.$router.push({path:"/article-list"}),this.$notify.success({title:"\u6210\u529F",message:"\u4FDD\u5B58\u8349\u7A3F\u6210\u529F"})):this.$notify.error({title:"\u5931\u8D25",message:"\u4FDD\u5B58\u8349\u7A3F\u5931\u8D25"})}),this.autoSave=!1},saveOrUpdateArticle(){if(this.article.articleTitle.trim()=="")return this.$message.error("\u6587\u7AE0\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A"),!1;if(this.article.articleContent.trim()=="")return this.$message.error("\u6587\u7AE0\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A"),!1;if(this.article.categoryName==null)return this.$message.error("\u6587\u7AE0\u5206\u7C7B\u4E0D\u80FD\u4E3A\u7A7A"),!1;if(this.article.tagNameList.length==0)return this.$message.error("\u6587\u7AE0\u6807\u7B7E\u4E0D\u80FD\u4E3A\u7A7A"),!1;this.axios.post("/api/article/saveOrUpdateArticle",this.article).then(({data:e})=>{e.flag?(this.article.id===null?this.$store.commit("removeTab","\u53D1\u5E03\u6587\u7AE0"):this.$store.commit("removeTab","\u4FEE\u6539\u6587\u7AE0"),sessionStorage.removeItem("article"),this.$router.push({path:"/article-list"}),this.$notify.success({title:"\u6210\u529F",message:e.message})):this.$notify.error({title:"\u5931\u8D25",message:e.message}),this.addOrEdit=!1}),this.autoSave=!1},autoSaveArticle(){this.autoSave&&this.article.articleTitle.trim()!=""&&this.article.articleContent.trim()!=""&&this.article.id!=null&&this.axios.post("/api/article/saveOrUpdateArticle",this.article).then(({data:e})=>{e.flag?this.$notify.success({title:"\u6210\u529F",message:"\u81EA\u52A8\u4FDD\u5B58\u6210\u529F"}):this.$notify.error({title:"\u5931\u8D25",message:"\u81EA\u52A8\u4FDD\u5B58\u5931\u8D25"})}),this.autoSave&&this.article.id==null&&sessionStorage.setItem("article",JSON.stringify(this.article))},searchCategories(e,t){this.axios.get("/api/category/getCategory",{params:{keywords:e}}).then(({data:r})=>{let o=r.data;t(o)})},handleSelectCategories(e){this.addCategory({categoryName:e.categoryName})},saveCategory(){this.categoryName.trim()!=""&&(this.article.categoryName=this.categoryName,this.categoryName="")},addCategory(e){this.article.categoryName=e.categoryName},removeCategory(){this.article.categoryName=null},searchTags(e,t){this.axios.get("/api/tag/getTag",{params:{keywords:e}}).then(({data:r})=>{t(r.data)})},handleSelectTag(e){this.addTag({tagName:e.tagName})},saveTag(){this.tagName.trim()!=""&&(this.addTag({tagName:this.tagName}),this.tagName="")},addTag(e){this.article.tagNameList.indexOf(e.tagName)==-1&&this.article.tagNameList.push(e.tagName)},removeTag(e){const t=this.article.tagNameList.indexOf(e);this.article.tagNameList.splice(t,1)}},computed:{tagClass(){return function(e){return this.article.tagNameList.indexOf(e.tagName)!=-1?"tag-item-select":"tag-item"}},dataFormat(){return function(e){return Y(e,"YYYY-MM-DD")}},myUploadClass(){return this.article.articleCover===""?"upload-cover":"my-upload-cover"}}},C=e=>(q("data-v-004ba79f"),e=e(),Q(),e),X={class:"title"},H={class:"article-title-container"},Z=C(()=>m("div",{class:"dialog-title-container"}," \u53D1\u5E03\u6587\u7AE0 ",-1)),ee=C(()=>m("div",{class:"popover-title"}," \u5206\u7C7B ",-1)),te={class:"popover-container"},ae=["onClick"],ie=C(()=>m("div",{class:"popover-title"},"\u6807\u7B7E",-1)),le={class:"popover-container"},se=C(()=>m("div",{style:{"margin-bottom":"1rem"}},"\u6DFB\u52A0\u6807\u7B7E",-1)),re={key:1,class:"el-upload__text"},oe=C(()=>m("em",null,"\u70B9\u51FB\u4E0A\u4F20",-1)),ne=["src"];function ce(e,t,r,o,v,l){const g=n("el-input"),u=n("el-button"),V=n("v-md-editor"),k=n("el-tag"),U=n("edit"),S=n("el-icon"),w=n("el-autocomplete"),$=n("el-popover"),h=n("el-form-item"),F=n("el-option"),x=n("el-select"),z=n("Upload"),D=n("el-upload"),E=n("el-switch"),L=n("el-radio"),G=n("el-radio-group"),B=n("el-form"),J=n("el-dialog"),K=n("el-card");return c(),p(K,{class:"main-card my-card-article"},{default:i(()=>[m("div",X,f(this.$route.name),1),m("div",H,[s(g,{modelValue:e.article.articleTitle,"onUpdate:modelValue":t[0]||(t[0]=a=>e.article.articleTitle=a),size:"default",placeholder:"\u8F93\u5165\u6587\u7AE0\u6807\u9898"},null,8,["modelValue"]),e.article.id==null||e.article.status==3?(c(),p(u,{key:0,type:"danger",size:"default",class:"save-btn",onClick:l.saveArticleDraft},{default:i(()=>[d(" \u4FDD\u5B58\u8349\u7A3F ")]),_:1},8,["onClick"])):_("",!0),s(u,{type:"danger",size:"default",onClick:l.openModel,style:{"margin-left":"10px"}},{default:i(()=>[d(" \u53D1\u5E03\u6587\u7AE0 ")]),_:1},8,["onClick"])]),s(V,{modelValue:e.article.articleContent,"onUpdate:modelValue":t[1]||(t[1]=a=>e.article.articleContent=a),"left-toolbar":e.leftToolbar,"disabled-menus":[],toolbar:e.toolbar,onUploadImage:l.handleUploadImage,onSave:l.saveChicked,ref:"md"},null,8,["modelValue","left-toolbar","toolbar","onUploadImage","onSave"]),s(J,{modelValue:e.addOrEdit,"onUpdate:modelValue":t[9]||(t[9]=a=>e.addOrEdit=a),width:"40%",top:"3vh"},{header:i(()=>[Z]),footer:i(()=>[s(u,{onClick:t[8]||(t[8]=a=>e.addOrEdit=!1)},{default:i(()=>[d("\u53D6 \u6D88")]),_:1}),s(u,{type:"danger",onClick:l.saveOrUpdateArticle},{default:i(()=>[d(" \u53D1 \u8868 ")]),_:1},8,["onClick"])]),default:i(()=>[s(B,{"label-width":"80px",size:"large",model:e.article},{default:i(()=>[s(h,{label:"\u6587\u7AE0\u5206\u7C7B"},{default:i(()=>[j(s(k,{type:"success",style:{margin:"0 1rem 0 0"},closable:!0,onClose:l.removeCategory},{default:i(()=>[d(f(e.article.categoryName),1)]),_:1},8,["onClose"]),[[M,e.article.categoryName]]),e.article.categoryName?_("",!0):(c(),p($,{key:0,placement:"bottom-start",width:"460",trigger:"click"},{reference:i(()=>[s(u,{type:"success",plain:"",slot:"reference",size:"default"},{default:i(()=>[d(" \u6DFB\u52A0\u5206\u7C7B ")]),_:1})]),default:i(()=>[ee,s(w,{style:{width:"100%"},modelValue:e.categoryName,"onUpdate:modelValue":t[2]||(t[2]=a=>e.categoryName=a),"fetch-suggestions":l.searchCategories,onKeyup:I(l.saveCategory,["enter","native"]),onSelect:l.handleSelectCategories,placeholder:"\u8BF7\u8F93\u5165\u5206\u7C7B\u540D\u641C\u7D22,enter\u53EF\u6DFB\u52A0\u81EA\u5B9A\u4E49\u5206\u7C7B","trigger-on-focus":!1},{suffix:i(()=>[s(S,null,{default:i(()=>[s(U)]),_:1})]),default:i(({item:a})=>[m("div",null,f(a.categoryName),1)]),_:1},8,["modelValue","fetch-suggestions","onKeyup","onSelect"]),m("div",te,[(c(!0),y(T,null,b(e.categoryList,a=>(c(),y("div",{key:a.id,class:"category-item",onClick:N=>l.addCategory(a)},f(a.categoryName),9,ae))),128))])]),_:1}))]),_:1}),s(h,{label:"\u6587\u7AE0\u6807\u7B7E"},{default:i(()=>[(c(!0),y(T,null,b(e.article.tagNameList,(a,N)=>(c(),p(k,{key:N,style:{margin:"0 1rem 0 0"},closable:!0,onClose:P=>l.removeTag(a)},{default:i(()=>[d(f(a),1)]),_:2},1032,["onClose"]))),128)),e.article.tagNameList.length<3?(c(),p($,{key:0,placement:"bottom-start",width:"460",trigger:"click"},{reference:i(()=>[s(u,{type:"primary",plain:"",slot:"reference",size:"default"},{default:i(()=>[d(" \u6DFB\u52A0\u6807\u7B7E ")]),_:1})]),default:i(()=>[ie,s(w,{style:{width:"100%"},modelValue:e.tagName,"onUpdate:modelValue":t[3]||(t[3]=a=>e.tagName=a),"fetch-suggestions":l.searchTags,placeholder:"\u8BF7\u8F93\u5165\u6807\u7B7E\u540D\u641C\u7D22,enter\u53EF\u6DFB\u52A0\u81EA\u5B9A\u4E49\u6807\u7B7E","trigger-on-focus":!1,onKeyup:I(l.saveTag,["enter","native"]),onSelect:l.handleSelectTag},{suffix:i(()=>[s(S,null,{default:i(()=>[s(U)]),_:1})]),default:i(({item:a})=>[m("div",null,f(a.tagName),1)]),_:1},8,["modelValue","fetch-suggestions","onKeyup","onSelect"]),m("div",le,[se,(c(!0),y(T,null,b(e.tagList,(a,N)=>(c(),p(k,{key:N,class:A(l.tagClass(a)),onClick:P=>l.addTag(a)},{default:i(()=>[d(f(a.tagName),1)]),_:2},1032,["class","onClick"]))),128))])]),_:1})):_("",!0)]),_:1}),s(h,{label:"\u6587\u7AE0\u7C7B\u578B"},{default:i(()=>[s(x,{modelValue:e.article.type,"onUpdate:modelValue":t[4]||(t[4]=a=>e.article.type=a),placeholder:"\u8BF7\u9009\u62E9\u7C7B\u578B"},{default:i(()=>[(c(!0),y(T,null,b(e.typeList,a=>(c(),p(F,{key:a.type,label:a.desc,value:a.type},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.article.type!=1?(c(),p(h,{key:0,label:"\u539F\u6587\u5730\u5740"},{default:i(()=>[s(g,{modelValue:e.article.originalUrl,"onUpdate:modelValue":t[5]||(t[5]=a=>e.article.originalUrl=a),placeholder:"\u8BF7\u586B\u5199\u539F\u6587\u94FE\u63A5"},null,8,["modelValue"])]),_:1})):_("",!0),s(h,{label:"\u6587\u7AE0\u5C01\u9762"},{default:i(()=>[s(D,{class:A(l.myUploadClass),drag:"",action:"/api/article/images","before-upload":l.beforeUpload,"on-success":l.uploadCover,"show-file-list":!1},{default:i(()=>[e.article.articleCover==""?(c(),p(S,{key:0},{default:i(()=>[s(z)]),_:1})):_("",!0),e.article.articleCover==""?(c(),y("div",re,[d(" \u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\uFF0C\u6216"),oe])):(c(),y("img",{key:2,src:e.article.articleCover,style:{width:"360px",height:"180px"}},null,8,ne))]),_:1},8,["class","before-upload","on-success"])]),_:1}),s(h,{label:"\u7F6E\u9876"},{default:i(()=>[s(E,{modelValue:e.article.isTop,"onUpdate:modelValue":t[6]||(t[6]=a=>e.article.isTop=a),"active-color":"#13ce66","inactive-color":"#F4F4F5","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),s(h,{label:"\u53D1\u5E03\u5F62\u5F0F"},{default:i(()=>[s(G,{modelValue:e.article.status,"onUpdate:modelValue":t[7]||(t[7]=a=>e.article.status=a)},{default:i(()=>[s(L,{label:1},{default:i(()=>[d("\u516C\u5F00")]),_:1}),s(L,{label:2},{default:i(()=>[d("\u79C1\u5BC6")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}var Je=R(W,[["render",ce],["__scopeId","data-v-004ba79f"]]);export{Je as default};
